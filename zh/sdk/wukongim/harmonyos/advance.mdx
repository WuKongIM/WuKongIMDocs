---
title: "é«˜çº§åŠŸèƒ½"
description: "WuKongIM HarmonyOS SDK é«˜çº§åŠŸèƒ½ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹å’Œæ‰©å±•åŠŸèƒ½"
icon: "settings"
---

é«˜çº§åŠŸèƒ½ä¸ºå¼€å‘è€…æä¾›äº†æ‰©å±• WuKongIM HarmonyOS SDK çš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹ã€æ¶ˆæ¯æ‰©å±•ã€æ¶ˆæ¯å›æ‰§ç­‰ä¼ä¸šçº§åŠŸèƒ½ã€‚

<Note>
åœ¨ WuKongIM ä¸­æ‰€æœ‰çš„æ¶ˆæ¯ç±»å‹éƒ½æ˜¯è‡ªå®šä¹‰æ¶ˆæ¯
</Note>

## è‡ªå®šä¹‰æ¶ˆæ¯

### è‡ªå®šä¹‰æ™®é€šæ¶ˆæ¯

ä¸‹é¢æˆ‘ä»¬ä»¥åç‰‡æ¶ˆæ¯ä¸¾ä¾‹ã€‚

#### ç¬¬ä¸€æ­¥ï¼šå®šä¹‰æ¶ˆæ¯

å®šä¹‰æ¶ˆæ¯å¯¹è±¡å¹¶ç»§æ‰¿ `WKMessageContent` å¹¶åœ¨æ„é€ æ–¹æ³•ä¸­æŒ‡å®šæ¶ˆæ¯ç±»å‹ã€‚

```typescript
// å®šä¹‰åç‰‡æ¶ˆæ¯
export class CardMessageContent extends WKMessageContent {
  uid: string = '';
  name: string = '';
  avatar: string = '';
  
  constructor() {
    super();
    this.contentType = 16; // æŒ‡å®šç±»å‹
  }
}
```

#### ç¬¬äºŒæ­¥ï¼šç¼–ç å’Œè§£ç 

æˆ‘ä»¬éœ€è¦å°† uidã€nameã€avatar ä¸‰ä¸ªå­—æ®µä¿¡æ¯å‘é€ç»™å¯¹æ–¹ï¼Œæœ€ç»ˆä¼ é€’çš„æ¶ˆæ¯å†…å®¹ä¸ºï¼š

```typescript
{
  "type": 16,
  "uid": "xxxx",
  "name": "xxx",
  "avatar": "xxx"
}
```

é‡å†™ `WKMessageContent` çš„ `encodeJson`ã€`decodeJson` æ–¹æ³•å¼€å§‹ç¼–ç è§£ç ï¼š

```typescript
// ç¼–ç å‘é€å†…å®¹
encodeJson(): Record<string, Object> {
  let json: Record<string, Object> = {};
  json['uid'] = this.uid;
  json['name'] = this.name;
  json['avatar'] = this.avatar;
  return json;
}

// è§£ç å†…å®¹
decodeJson(jsonStr: string): WKMessageContent {
  let json = CommonUtil.jsonToRecord(jsonStr);
  if (json !== undefined) {
    this.uid = CommonUtil.readString(json, 'uid');
    this.name = CommonUtil.readString(json, 'name');
    this.avatar = CommonUtil.readString(json, 'avatar');
  }
  return this;
}
```

<Note>
è§£ç å’Œç¼–ç æ¶ˆæ¯æ—¶æ— éœ€å°† `type` å­—æ®µè€ƒè™‘å…¶ä¸­ï¼ŒSDK å†…éƒ¨ä¼šè‡ªåŠ¨å¤„ç†
</Note>

#### ç¬¬ä¸‰æ­¥ï¼šæ³¨å†Œæ¶ˆæ¯

```typescript
// æ³¨å†Œè‡ªå®šä¹‰æ¶ˆæ¯
WKIM.shared.messageManager().registerMsgContent(16, (jsonStr: string) => {
  return new CardMessageContent().decodeJson(jsonStr);
});
```

### å®Œæ•´åç‰‡æ¶ˆæ¯å®ç°

```typescript
// è‡ªå®šä¹‰æ™®é€šæ¶ˆæ¯
export class CardMessageContent extends WKMessageContent {
  uid: string = '';
  name: string = '';
  avatar: string = '';
  
  constructor() {
    super();
    this.contentType = 16; // æŒ‡å®šç±»å‹
  }

  // ç¼–ç å‘é€å†…å®¹
  encodeJson(): Record<string, Object> {
    let json: Record<string, Object> = {};
    json['uid'] = this.uid;
    json['name'] = this.name;
    json['avatar'] = this.avatar;
    return json;
  }

  // è§£ç å†…å®¹
  decodeJson(jsonStr: string): WKMessageContent {
    let json = CommonUtil.jsonToRecord(jsonStr);
    if (json !== undefined) {
      this.uid = CommonUtil.readString(json, 'uid');
      this.name = CommonUtil.readString(json, 'name');
      this.avatar = CommonUtil.readString(json, 'avatar');
    }
    return this;
  }

  // æœ€è¿‘ä¼šè¯æ˜¾ç¤ºå†…å®¹
  displayText(): string {
    return '[åç‰‡]';
  }
  
  // éªŒè¯æ¶ˆæ¯å†…å®¹
  isValid(): boolean {
    return this.uid.length > 0 && this.name.length > 0;
  }
}

// æ³¨å†Œåç‰‡æ¶ˆæ¯ç±»å‹
WKIM.shared.messageManager().registerMsgContent(16, (jsonStr: string) => {
  return new CardMessageContent().decodeJson(jsonStr);
});

// å‘é€åç‰‡æ¶ˆæ¯
function sendCardMessage(channelId: string, channelType: number, uid: string, name: string, avatar: string): void {
  const cardContent = new CardMessageContent();
  cardContent.uid = uid;
  cardContent.name = name;
  cardContent.avatar = avatar;
  
  if (cardContent.isValid()) {
    WKIM.shared.messageManager().send(cardContent, new WKChannel(channelId, channelType));
  }
}
```

## è‡ªå®šä¹‰é™„ä»¶æ¶ˆæ¯

æˆ‘ä»¬åœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™æœ‰æ—¶éœ€å‘é€å¸¦é™„ä»¶çš„æ¶ˆæ¯ã€‚WuKongIM ä¹Ÿæä¾›è‡ªå®šä¹‰é™„ä»¶æ¶ˆæ¯ï¼Œè‡ªå®šä¹‰é™„ä»¶æ¶ˆæ¯å’Œæ™®é€šæ¶ˆæ¯åŒºåˆ«ä¸å¤§ã€‚ä¸‹é¢æˆ‘ä»¬ä»¥åœ°ç†ä½ç½®æ¶ˆæ¯ä¸¾ä¾‹ã€‚

### ç¬¬ä¸€æ­¥ï¼šå®šä¹‰æ¶ˆæ¯

å€¼å¾—æ³¨æ„çš„æ˜¯è‡ªå®šä¹‰é™„ä»¶æ¶ˆæ¯éœ€ç»§æ‰¿ `WKMediaMessageContent` è€Œä¸æ˜¯ `WKMessageContent`ã€‚

```typescript
export class LocationMessageContent extends WKMediaMessageContent {
  address: string = '';
  longitude: number = 0.0;
  latitude: number = 0.0;

  constructor() {
    super();
    this.contentType = 17; // æŒ‡å®šç±»å‹
  }
}
```

<Note>
`WKMediaMessageContent` æä¾›äº† `url`ã€`localPath` å­—æ®µï¼Œè‡ªå®šä¹‰æ¶ˆæ¯æ— éœ€å†å®šä¹‰ç½‘ç»œåœ°å€å’Œæœ¬åœ°åœ°å€å­—æ®µ
</Note>

### ç¬¬äºŒæ­¥ï¼šç¼–ç å’Œè§£ç 

æˆ‘ä»¬éœ€è¦å°† `longitude`ã€`latitude`ã€`address`ã€`url` ä¿¡æ¯å‘é€ç»™å¯¹æ–¹ï¼Œæœ€ç»ˆä¼ é€’çš„æ¶ˆæ¯å†…å®¹ä¸ºï¼š

```typescript
{
  "type": 17,
  "longitude": 115.25,
  "latitude": 39.26,
  "url": "xxx",
  "address": "xxx"
}
```

é‡å†™ `WKMessageContent` çš„ `encodeJson`ã€`decodeJson` æ–¹æ³•å¼€å§‹ç¼–ç è§£ç ï¼š

```typescript
// ç¼–ç 
encodeJson(): Record<string, Object> {
  let json: Record<string, Object> = {};
  json['url'] = this.url;
  json['longitude'] = this.longitude;
  json['latitude'] = this.latitude;
  json['address'] = this.address;
  return json;
}

// è§£ç 
decodeJson(jsonStr: string): WKMessageContent {
  let json = CommonUtil.jsonToRecord(jsonStr);
  if (json !== undefined) {
    this.address = CommonUtil.readString(json, 'address');
    this.url = CommonUtil.readString(json, 'url');
    this.longitude = CommonUtil.readNumber(json, 'longitude');
    this.latitude = CommonUtil.readNumber(json, 'latitude');
  }
  return this;
}
```

### ç¬¬ä¸‰æ­¥ï¼šæ³¨å†Œæ¶ˆæ¯

```typescript
// æ³¨å†Œè‡ªå®šä¹‰æ¶ˆæ¯
WKIM.shared.messageManager().registerMsgContent(17, (jsonStr: string) => {
  return new LocationMessageContent().decodeJson(jsonStr);
});
```

### å®Œæ•´ä½ç½®æ¶ˆæ¯å®ç°

```typescript
export class LocationMessageContent extends WKMediaMessageContent {
  address: string = '';
  longitude: number = 0.0;
  latitude: number = 0.0;
  title: string = '';
  mapType: string = '';

  constructor() {
    super();
    this.contentType = 17; // æŒ‡å®šç±»å‹
  }

  // ç¼–ç 
  encodeJson(): Record<string, Object> {
    let json: Record<string, Object> = {};
    json['url'] = this.url;
    json['longitude'] = this.longitude;
    json['latitude'] = this.latitude;
    json['address'] = this.address;
    
    if (this.title) json['title'] = this.title;
    if (this.mapType) json['map_type'] = this.mapType;
    
    return json;
  }

  // è§£ç 
  decodeJson(jsonStr: string): WKMessageContent {
    let json = CommonUtil.jsonToRecord(jsonStr);
    if (json !== undefined) {
      this.address = CommonUtil.readString(json, 'address');
      this.url = CommonUtil.readString(json, 'url');
      this.longitude = CommonUtil.readNumber(json, 'longitude');
      this.latitude = CommonUtil.readNumber(json, 'latitude');
      this.title = CommonUtil.readString(json, 'title');
      this.mapType = CommonUtil.readString(json, 'map_type');
    }
    return this;
  }

  // æœ€è¿‘ä¼šè¯æ˜¾ç¤ºå†…å®¹
  displayText(): string {
    return this.title ? `[ä½ç½®] ${this.title}` : `[ä½ç½®] ${this.address}`;
  }
  
  // éªŒè¯ä½ç½®ä¿¡æ¯
  isValid(): boolean {
    return this.latitude !== 0 && this.longitude !== 0 && this.address.length > 0;
  }
  
  // è·å–åœ°å›¾é“¾æ¥
  getMapUrl(): string {
    return `https://maps.google.com/?q=${this.latitude},${this.longitude}`;
  }
}

// æ³¨å†Œä½ç½®æ¶ˆæ¯ç±»å‹
WKIM.shared.messageManager().registerMsgContent(17, (jsonStr: string) => {
  return new LocationMessageContent().decodeJson(jsonStr);
});

// å‘é€ä½ç½®æ¶ˆæ¯
function sendLocationMessage(channelId: string, channelType: number, longitude: number, latitude: number, address: string): void {
  const locationContent = new LocationMessageContent();
  locationContent.longitude = longitude;
  locationContent.latitude = latitude;
  locationContent.address = address;
  
  if (locationContent.isValid()) {
    WKIM.shared.messageManager().send(locationContent, new WKChannel(channelId, channelType));
  }
}
```

## æ¶ˆæ¯æ‰©å±•

éšç€ä¸šåŠ¡çš„å‘å±•åº”ç”¨åœ¨èŠå¤©ä¸­çš„åŠŸèƒ½ä¹Ÿæ—¥ç›Šå¢å¤šï¼Œä¸ºäº†æ»¡è¶³ç»å¤§éƒ¨åˆ†çš„éœ€æ±‚ WuKongIM ä¸­å¢åŠ äº†æ¶ˆæ¯æ‰©å±•åŠŸèƒ½ã€‚æ¶ˆæ¯æ‰©å±•åˆ† `æœ¬åœ°æ‰©å±•` å’Œ `è¿œç¨‹æ‰©å±•`ï¼Œæœ¬åœ°æ‰©å±•åªé’ˆå¯¹ app æœ¬åœ°ä½¿ç”¨å¸è½½ app åå°†ä¸¢å¤±ï¼Œè¿œç¨‹æ‰©å±•æ˜¯æœåŠ¡å™¨ä¿å­˜å¸è½½é‡è£…åæ•°æ®å°†æ¢å¤ã€‚

### æœ¬åœ°æ‰©å±•

æœ¬åœ°æ‰©å±•å°±æ˜¯æ¶ˆæ¯å¯¹è±¡ `WKMsg` ä¸­çš„ `localExtraMap` å­—æ®µã€‚

```typescript
/**
 * ä¿®æ”¹æ¶ˆæ¯æœ¬åœ°æ‰©å±•
 *
 * @param clientMsgNo å®¢æˆ·ç«¯ID
 * @param extra   æ‰©å±•å­—æ®µ
 */
WKIM.shared.messageManager().updateLocalExtra(clientMsgNo: string, extra: Record<string, Object>);
```

<Note>
æ›´æ–°æˆåŠŸå SDK ä¼šè§¦å‘åˆ·æ–°æ¶ˆæ¯å›è°ƒ
</Note>

### è¿œç¨‹æ‰©å±•

è¿œç¨‹æ‰©å±•å°±æ˜¯æ¶ˆæ¯å¯¹è±¡ `WKMsg` ä¸­çš„ `remoteExtra` å­—æ®µã€‚

```typescript
WKIM.shared.messageManager().saveRemoteExtras(list: WKMsgExtra[]);
```

<Note>
æ›´æ–°æˆåŠŸå SDK ä¼šè§¦å‘åˆ·æ–°æ¶ˆæ¯å›è°ƒ
</Note>

### æ¶ˆæ¯æ‰©å±•ç®¡ç†ç¤ºä¾‹

```typescript
class MessageExtraManager {
  
  // æ·»åŠ æœ¬åœ°æ ‡è®°
  static addLocalTag(clientMsgNo: string, key: string, value: any): void {
    const extraData: Record<string, Object> = {};
    extraData[key] = value;
    WKIM.shared.messageManager().updateLocalExtra(clientMsgNo, extraData);
  }
  
  // æ ‡è®°æ¶ˆæ¯ä¸ºé‡è¦
  static markAsImportant(clientMsgNo: string, important: boolean): void {
    this.addLocalTag(clientMsgNo, 'important', important);
  }
  
  // æ·»åŠ æœ¬åœ°å¤‡æ³¨
  static addLocalNote(clientMsgNo: string, note: string): void {
    this.addLocalTag(clientMsgNo, 'note', note);
  }
  
  // è®¾ç½®æ¶ˆæ¯æé†’æ—¶é—´
  static setReminder(clientMsgNo: string, reminderTime: number): void {
    this.addLocalTag(clientMsgNo, 'reminder_time', reminderTime);
  }
  
  // æ‰¹é‡å¤„ç†è¿œç¨‹æ‰©å±•
  static batchUpdateRemoteExtra(extraList: WKMsgExtra[]): void {
    if (extraList.length > 0) {
      WKIM.shared.messageManager().saveRemoteExtras(extraList);
    }
  }
  
  // è·å–æ¶ˆæ¯çš„æœ¬åœ°æ‰©å±•
  static getLocalExtra(message: WKMsg, key: string): any {
    if (message.localExtraMap) {
      return message.localExtraMap[key];
    }
    return null;
  }
  
  // æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦è¢«æ ‡è®°ä¸ºé‡è¦
  static isImportant(message: WKMsg): boolean {
    const important = this.getLocalExtra(message, 'important');
    return important === true;
  }
  
  // è·å–æ¶ˆæ¯å¤‡æ³¨
  static getLocalNote(message: WKMsg): string | null {
    const note = this.getLocalExtra(message, 'note');
    return typeof note === 'string' ? note : null;
  }
}
```

### WKMsgExtra æ•°æ®ç»“æ„è¯´æ˜

```typescript
export class WKMsgExtra {
  // æ¶ˆæ¯ID
  messageId = '';
  // é¢‘é“ID
  channelId = '';
  // é¢‘é“ç±»å‹
  channelType: number = WKChannelType.personal;
  // æ˜¯å¦å·²è¯» 1.æ˜¯
  readed = 0;
  // å·²è¯»æ•°é‡
  readedCount = 0;
  // æœªè¯»æ•°é‡
  unreadCount = 0;
  // æ˜¯å¦æ’¤å› 1.æ˜¯
  revoke = 0;
  // æ˜¯å¦åˆ é™¤
  isMutualDeleted = 0;
  // æ’¤å›è€…uid
  revoker = '';
  // ç‰ˆæœ¬å·
  extraVersion = 0;
  // ç¼–è¾‘æ—¶é—´
  editedAt = 0;
  // ç¼–è¾‘å†…å®¹
  contentEdit = '';
  // æ˜¯å¦éœ€è¦ä¸Šä¼  1.æ˜¯
  needUpload = 0;
  // æ˜¯å¦ç½®é¡¶
  isPinned = 0;
  // ç¼–è¾‘åæ­£æ–‡
  contentEditMsgModel?: WKMessageContent;
}
```

## æ¶ˆæ¯å·²è¯»æœªè¯»

æ¶ˆæ¯çš„å·²è¯»æœªè¯»åˆç§°æ¶ˆæ¯å›æ‰§ã€‚æ¶ˆæ¯å›æ‰§åŠŸèƒ½å¯é€šè¿‡ setting è¿›è¡Œè®¾ç½®ã€‚

```typescript
let option = new WKSendOptions();
option.setting.receipt = 1; // å¼€å¯å›æ‰§
// å‘é€æ¶ˆæ¯
WKIM.shared.messageManager().sendWithOption(textModel, channel, option);
```

å½“ç™»å½•ç”¨æˆ·æµè§ˆè¿‡å¯¹æ–¹å‘é€çš„æ¶ˆæ¯æ—¶ï¼Œå¦‚æœå¯¹æ–¹å¼€å¯äº†æ¶ˆæ¯å›æ‰§è¿™æ—¶éœ€å°†æŸ¥çœ‹è¿‡çš„æ¶ˆæ¯ä¸Šä¼ åˆ°æœåŠ¡å™¨æ ‡è®°è¯¥æ¶ˆæ¯å·²è¯»ã€‚å½“å¯¹æ–¹æˆ–è€…è‡ªå·±ä¸Šä¼ è¿‡å·²è¯»æ¶ˆæ¯è¿™æ—¶ä¸šåŠ¡æœåŠ¡å™¨ä¼šä¸‹å‘åŒæ­¥æ¶ˆæ¯æ‰©å±•çš„ cmd(å‘½ä»¤)æ¶ˆæ¯ `syncMessageExtra`ï¼Œæ­¤æ—¶éœ€åŒæ­¥æœ€æ–°æ¶ˆæ¯æ‰©å±•ä¿å­˜åˆ° SDK ä¸­ã€‚

### æ¶ˆæ¯å›æ‰§ç®¡ç†ç¤ºä¾‹

```typescript
class MessageReceiptManager {
  
  // å‘é€å¸¦å›æ‰§çš„æ¶ˆæ¯
  static sendMessageWithReceipt(content: WKMessageContent, channel: WKChannel): void {
    const option = new WKSendOptions();
    option.setting.receipt = 1; // å¼€å¯å›æ‰§
    
    WKIM.shared.messageManager().sendWithOption(content, channel, option);
  }
  
  // æ‰¹é‡æ ‡è®°æ¶ˆæ¯ä¸ºå·²è¯»
  static async markMessagesAsRead(messageIds: string[], channelId: string, channelType: number): Promise<void> {
    // è¿™é‡Œéœ€è¦è°ƒç”¨ä¸šåŠ¡æœåŠ¡å™¨çš„APIæ¥æ ‡è®°æ¶ˆæ¯å·²è¯»
    // æœåŠ¡å™¨ä¼šä¸‹å‘åŒæ­¥æ¶ˆæ¯æ‰©å±•çš„å‘½ä»¤
    await this.uploadReadStatus(messageIds, channelId, channelType);
  }
  
  // ä¸Šä¼ å·²è¯»çŠ¶æ€åˆ°æœåŠ¡å™¨
  private static async uploadReadStatus(messageIds: string[], channelId: string, channelType: number): Promise<void> {
    // å®ç°ä¸Šä¼ é€»è¾‘
    // æˆåŠŸåæœåŠ¡å™¨ä¼šä¸‹å‘ syncMessageExtra å‘½ä»¤
  }
  
  // è·å–æ¶ˆæ¯å·²è¯»æ•°é‡
  static getReadCount(message: WKMsg): number {
    if (message.wkMsgExtra) {
      return message.wkMsgExtra.readedCount;
    }
    return 0;
  }
  
  // è·å–æ¶ˆæ¯æœªè¯»æ•°é‡
  static getUnreadCount(message: WKMsg): number {
    if (message.wkMsgExtra) {
      return message.wkMsgExtra.unreadCount;
    }
    return 0;
  }
  
  // æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦å·²è¯»
  static isMessageRead(message: WKMsg): boolean {
    if (message.wkMsgExtra) {
      return message.wkMsgExtra.readed === 1;
    }
    return false;
  }
}
```

## æ¶ˆæ¯ç¼–è¾‘

å½“æˆ‘ä»¬ç»™å¯¹æ–¹å‘é€æ¶ˆæ¯å‘ç°å‘é€å†…å®¹æœ‰é”™è¯¯æ—¶ï¼Œè¿™æ—¶æ— éœ€æ’¤å›é‡å‘åªéœ€è¦å°†æ¶ˆæ¯ç¼–è¾‘å³å¯ã€‚

### è®¾ç½®ç¼–è¾‘å†…å®¹

```typescript
/**
 * ä¿®æ”¹ç¼–è¾‘å†…å®¹
 * @param messageId æ¶ˆæ¯æœåŠ¡å™¨ID
 * @param channelId é¢‘é“ID
 * @param channelType é¢‘é“ç±»å‹
 * @param content ç¼–è¾‘åçš„å†…å®¹
 */
WKIM.shared.messageManager().updateEdit(messageId: string, channelId: string, channelType: number, content: string);
```

æ›´æ”¹ SDK æ¶ˆæ¯ç¼–è¾‘å†…å®¹åéœ€å°†ç¼–è¾‘åçš„å†…å®¹ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œåˆ™éœ€è¦ç›‘å¬ä¸Šä¼ æ¶ˆæ¯æ‰©å±•ã€‚

```typescript
WKIM.shared.config.provider.uploadMessageExtraCallback = (extra: WKMsgExtra) => {
  // ä¸Šä¼ åˆ°ä¸šåŠ¡æœåŠ¡å™¨
};
```

### æ¶ˆæ¯ç¼–è¾‘ç®¡ç†ç¤ºä¾‹

```typescript
class MessageEditManager {
  
  // ç¼–è¾‘æ–‡æœ¬æ¶ˆæ¯
  static editTextMessage(messageId: string, channelId: string, channelType: number, newContent: string): void {
    WKIM.shared.messageManager().updateEdit(messageId, channelId, channelType, newContent);
  }
  
  // è®¾ç½®ç¼–è¾‘ç›‘å¬å™¨
  static setupEditListener(): void {
    WKIM.shared.config.provider.uploadMessageExtraCallback = (extra: WKMsgExtra) => {
      if (extra.editedAt > 0 && extra.contentEdit.length > 0) {
        // ä¸Šä¼ ç¼–è¾‘å†…å®¹åˆ°æœåŠ¡å™¨
        this.uploadEditedMessage(extra);
      }
    };
  }
  
  // ä¸Šä¼ ç¼–è¾‘åçš„æ¶ˆæ¯åˆ°æœåŠ¡å™¨
  private static async uploadEditedMessage(msgExtra: WKMsgExtra): Promise<void> {
    // å®ç°ä¸Šä¼ é€»è¾‘
    // åŒ…å«æ¶ˆæ¯IDã€ç¼–è¾‘å†…å®¹ã€ç¼–è¾‘æ—¶é—´ç­‰ä¿¡æ¯
  }
  
  // æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦è¢«ç¼–è¾‘è¿‡
  static isMessageEdited(message: WKMsg): boolean {
    return message.wkMsgExtra !== null && 
           message.wkMsgExtra.editedAt > 0 && 
           message.wkMsgExtra.contentEdit.length > 0;
  }
  
  // è·å–æ¶ˆæ¯ç¼–è¾‘å†…å®¹
  static getEditedContent(message: WKMsg): string | null {
    if (this.isMessageEdited(message)) {
      return message.wkMsgExtra!.contentEdit;
    }
    return null;
  }
  
  // è·å–æ¶ˆæ¯ç¼–è¾‘æ—¶é—´
  static getEditedTime(message: WKMsg): number {
    if (message.wkMsgExtra) {
      return message.wkMsgExtra.editedAt;
    }
    return 0;
  }
}
```

## æ¶ˆæ¯å›å¤

åœ¨èŠå¤©ä¸­å¦‚æœæ¶ˆæ¯è¿‡å¤šï¼Œå‘é€æ¶ˆæ¯å›å¤å°±ä¼šæ˜¾å¾—æ¶ˆæ¯å¾ˆä¹±æ— ç« å¯å¾ªã€‚è¿™æ—¶å°±éœ€è¦å¯¹æŸæ¡æ¶ˆæ¯è¿›è¡Œç‰¹å®šçš„å›å¤ï¼Œå³æ¶ˆæ¯å›å¤ã€‚

åœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œåªéœ€å°†æ¶ˆæ¯æ­£æ–‡ `WKMessageContent` ä¸­çš„ `WKReply` å¯¹è±¡èµ‹å€¼å°±èƒ½è¾¾åˆ°æ¶ˆæ¯å›å¤æ•ˆæœã€‚

```typescript
let textModel: WKTextContent = new WKTextContent(this.sendContent);
textModel.reply = new WKReply();
textModel.reply.messageId = '';
// è®¾ç½®å…¶ä»–å­—æ®µä¿¡æ¯

// å‘é€æ¶ˆæ¯
WKIM.shared.messageManager().send(textModel, channel);
```

### WKReply å›å¤æ¶ˆæ¯ç»“æ„è¯´æ˜

```typescript
export class WKReply {
  // è¢«å›å¤çš„æ¶ˆæ¯æ ¹IDï¼Œå¤šçº§å›å¤æ—¶çš„ç¬¬ä¸€æ¬¡å›å¤çš„æ¶ˆæ¯ID
  rootMid = '';
  // è¢«å›å¤çš„æ¶ˆæ¯ID
  messageId = '';
  // è¢«å›å¤çš„MessageSeq
  messageSeq = 0;
  // è¢«å›å¤è€…uid
  fromUID = '';
  // è¢«å›å¤è€…åç§°
  fromName = '';
  // è¢«å›å¤çš„æ¶ˆæ¯å­—ç¬¦ä¸²
  contentEdit = '';
  // ç¼–è¾‘æ—¶é—´
  editAt = 0;
  // å›å¤æ¶ˆæ¯è¢«æ’¤å›æ ‡è®° 1.æ˜¯
  revoke = 0;
  // è¢«å›å¤æ¶ˆæ¯ç¼–è¾‘åçš„å†…å®¹
  contentEditMsgModel?: WKMessageContent;
  // è¢«å›å¤çš„æ¶ˆæ¯ä½“
  payload?: WKMessageContent;
}
```

## æ¶ˆæ¯å›åº”ï¼ˆç‚¹èµï¼‰

### ä¿å­˜

```typescript
WKIM.shared.messageManager().saveReactions(list: WKMsgReaction[]);
```

<Note>
åŒä¸€ä¸ªç”¨æˆ·å¯¹åŒä¸€æ¡æ¶ˆæ¯åªèƒ½åšå‡ºä¸€æ¡å›åº”ã€‚é‡å¤è¿›è¡Œæ¶ˆæ¯ä¸åŒ emoji çš„å›åº”ä¼šåšä¸ºä¿®æ”¹å›åº”ï¼Œé‡å¤è¿›è¡Œç›¸åŒ emoji çš„å›åº”åˆ™åšä¸ºåˆ é™¤å›åº”
</Note>

SDK æ›´æ–°æ¶ˆæ¯å›åº”åä¼šè§¦å‘æ¶ˆæ¯åˆ·æ–°çš„äº‹ä»¶ã€‚app éœ€ç›‘å¬æ­¤äº‹ä»¶å¹¶å¯¹ UI è¿›è¡Œåˆ·æ–°ã€‚

ç›‘å¬æ¶ˆæ¯å›åº”åˆ·æ–°ï¼š

```typescript
// ç›‘å¬æ¶ˆæ¯å›åº”åˆ·æ–°
WKIM.shared.messageManager().addRefreshReactionListener((list) => {
  // åˆ·æ–° UI
});
```

### è·å–

```typescript
WKIM.shared.messageManager().getMsgReactions(messageId: string);
```

### WKMsgReaction æ•°æ®ç»“æ„è¯´æ˜

```typescript
export class WKMsgReaction {
  // æ¶ˆæ¯ID
  messageId = "";
  // é¢‘é“ID
  channelId = "";
  // é¢‘é“ç±»å‹
  channelType = WKChannelType.personal;
  // å›åº”è€…uid
  uid = "";
  // æ¶ˆæ¯åºå·
  seq = 0;
  // å›åº”è¡¨æƒ…
  emoji = "";
  // æ˜¯å¦åˆ é™¤ 1.æ˜¯
  isDeleted = 0;
  // åˆ›å»ºæ—¶é—´
  createdAt = "";
}
```

## ä¸‹ä¸€æ­¥

<CardGroup cols={2}>
  <Card
    title="æ•°æ®æºé…ç½®"
    icon="database"
    href="/zh/sdk/wukongim/harmonyos/datasource"
  >
    å›åˆ°æ•°æ®æºé…ç½®
  </Card>
  <Card
    title="æ¶ˆæ¯ç®¡ç†"
    icon="message-circle"
    href="/zh/sdk/wukongim/harmonyos/message"
  >
    å›åˆ°æ¶ˆæ¯æ”¶å‘åŠŸèƒ½
  </Card>
  <Card
    title="é¢‘é“ç®¡ç†"
    icon="hash"
    href="/zh/sdk/wukongim/harmonyos/channel"
  >
    å›åˆ°é¢‘é“ç®¡ç†åŠŸèƒ½
  </Card>
  <Card
    title="åŸºç¡€åŠŸèƒ½"
    icon="foundation"
    href="/zh/sdk/wukongim/harmonyos/base"
  >
    å›åˆ°åŸºç¡€åŠŸèƒ½
  </Card>
</CardGroup>

## æ€»ç»“

HarmonyOS SDK ç°å·²å®Œæˆæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ–‡æ¡£ï¼š

âœ… **é›†æˆæŒ‡å—** - å®Œæ•´çš„å®‰è£…å’Œé…ç½®æŒ‡å¯¼  
âœ… **åŸºç¡€åŠŸèƒ½** - è¿æ¥ç®¡ç†å’ŒåŸºç¡€API  
âœ… **æ¶ˆæ¯ç®¡ç†** - æ¶ˆæ¯æ”¶å‘å’Œå†å²æ¶ˆæ¯  
âœ… **é¢‘é“ç®¡ç†** - é¢‘é“ä¿¡æ¯å’Œæˆå‘˜ç®¡ç†  
âœ… **ä¼šè¯ç®¡ç†** - ä¼šè¯åˆ—è¡¨å’Œæœªè¯»æ¶ˆæ¯  
âœ… **æ•°æ®æºé…ç½®** - æ–‡ä»¶ä¸Šä¼ å’Œæ•°æ®åŒæ­¥  
âœ… **é«˜çº§åŠŸèƒ½** - è‡ªå®šä¹‰æ¶ˆæ¯å’Œæ‰©å±•ç‰¹æ€§  

HarmonyOS SDK æ–‡æ¡£å·²å…¨é¢å®Œæˆï¼Œä¸ºå¼€å‘è€…æä¾›äº†ä»å…¥é—¨åˆ°é«˜çº§çš„å®Œæ•´æŠ€æœ¯æŒ‡å¯¼ï¼ğŸ‰
