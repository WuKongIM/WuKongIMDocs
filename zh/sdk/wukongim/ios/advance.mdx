---
title: "é«˜çº§åŠŸèƒ½"
description: "WuKongIM iOS SDK é«˜çº§åŠŸèƒ½ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰æ¶ˆæ¯ã€æ¶ˆæ¯å›åº”ç­‰"
icon: "cog"
---

æœ¬æŒ‡å—æ¶µç›–äº† WuKongIM iOS SDK çš„é«˜çº§åŠŸèƒ½ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰æ¶ˆæ¯ã€æ¶ˆæ¯å›åº”ã€æ¶ˆæ¯ç¼–è¾‘å’Œå…¶ä»–é«˜çº§åŠŸèƒ½ã€‚

## è‡ªå®šä¹‰æ¶ˆæ¯

### åˆ›å»ºè‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹

æ‚¨å¯ä»¥é€šè¿‡ç»§æ‰¿ `WKMessageContent` æ¥åˆ›å»ºè‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹ã€‚ä»¥ä¸‹æ˜¯åˆ›å»º GIF æ¶ˆæ¯çš„ç¤ºä¾‹ï¼š

```objc
@interface WKGIFContent : WKMessageContent

// GIF åœ°å€
@property(nonatomic,copy) NSString *url;
// å®½åº¦
@property(nonatomic,assign) NSInteger width;
// é«˜åº¦
@property(nonatomic,assign) NSInteger height;

@end
```

### å®ç°ç¼–ç /è§£ç 

```objc
@implementation WKGIFContent

- (NSDictionary *)encodeMsg {
    NSMutableDictionary *dataDict = [NSMutableDictionary dictionary];
    if(self.url) {
        dataDict[@"url"] = self.url;
    }
    dataDict[@"width"] = @(self.width);
    dataDict[@"height"] = @(self.height);
    return dataDict;
}

- (void)decodeMsg:(NSDictionary *)contentDict {
    self.url = contentDict[@"url"];
    self.width = [contentDict[@"width"] integerValue];
    self.height = [contentDict[@"height"] integerValue];
}

- (WKContentType)contentType {
    return 3; // è‡ªå®šä¹‰ç±»å‹ç¼–å·
}

@end
```

### æ³¨å†Œè‡ªå®šä¹‰æ¶ˆæ¯

```objc
// æ³¨å†Œè‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹
[[WKIM shared].messageManager registerContentClass:[WKGIFContent class]];
```

### å‘é€è‡ªå®šä¹‰æ¶ˆæ¯

```objc
WKGIFContent *gifContent = [[WKGIFContent alloc] init];
gifContent.url = @"https://example.com/animation.gif";
gifContent.width = 300;
gifContent.height = 200;

[[WKIM shared].messageManager sendMessage:gifContent 
                                channelId:@"channel123" 
                              channelType:WKChannelTypePerson];
```

## æ¶ˆæ¯å›åº”

### æ·»åŠ å›åº”

```objc
// ä¸ºæ¶ˆæ¯æ·»åŠ å›åº”
[[WKIM shared].messageManager addReaction:@"ğŸ‘" 
                                messageId:@"msg123" 
                                channelId:@"channel123" 
                              channelType:WKChannelTypePerson];
```

### ç§»é™¤å›åº”

```objc
// ä»æ¶ˆæ¯ä¸­ç§»é™¤å›åº”
[[WKIM shared].messageManager removeReaction:@"ğŸ‘" 
                                   messageId:@"msg123" 
                                   channelId:@"channel123" 
                                 channelType:WKChannelTypePerson];
```

### ç›‘å¬å›åº”æ›´æ–°

```objc
// ç›‘å¬å›åº”æ›´æ–°
[[WKIM shared].messageManager addOnRefreshMsgListener:^(WKMessage *message) {
    // å¤„ç†åŒ…æ‹¬å›åº”åœ¨å†…çš„æ¶ˆæ¯æ›´æ–°
    if (message.reactions.count > 0) {
        // ä½¿ç”¨æ–°å›åº”æ›´æ–° UI
    }
}];
```

## æ¶ˆæ¯ç¼–è¾‘

### ç¼–è¾‘æ–‡æœ¬æ¶ˆæ¯

```objc
// ç¼–è¾‘æ–‡æœ¬æ¶ˆæ¯
WKTextContent *editedContent = [[WKTextContent alloc] init];
editedContent.content = @"ç¼–è¾‘åçš„æ¶ˆæ¯å†…å®¹";

[[WKIM shared].messageManager editMessage:editedContent 
                                messageId:@"msg123" 
                                channelId:@"channel123" 
                              channelType:WKChannelTypePerson];
```

### å¤„ç†ç¼–è¾‘äº‹ä»¶

```objc
// ç›‘å¬æ¶ˆæ¯ç¼–è¾‘äº‹ä»¶
[[WKIM shared].messageManager addOnRefreshMsgListener:^(WKMessage *message) {
    if (message.edited) {
        // æ¶ˆæ¯å·²è¢«ç¼–è¾‘ï¼Œæ›´æ–° UI
        NSLog(@"æ¶ˆæ¯å·²ç¼–è¾‘: %@", message.content);
    }
}];
```

## æ¶ˆæ¯å·²è¯»å›æ‰§

### æ ‡è®°æ¶ˆæ¯ä¸ºå·²è¯»

```objc
// æ ‡è®°æ¶ˆæ¯ä¸ºå·²è¯»
NSArray<WKMessage *> *messages = @[message1, message2, message3];
[[WKIM shared].messageManager markMessagesAsRead:messages];
```

### ä¸Šä¼ å·²è¯»çŠ¶æ€

```objc
// ä¸Šä¼ å·²è¯»çŠ¶æ€åˆ°æœåŠ¡å™¨
[[WKIM shared].messageManager uploadReadStatus:@"channel123" 
                                   channelType:WKChannelTypePerson 
                                    messageSeq:lastReadMessageSeq];
```

## æ¶ˆæ¯æé†’

### åˆ›å»ºæé†’

```objc
// ä¸ºæ¶ˆæ¯åˆ›å»ºæé†’
WKReminder *reminder = [[WKReminder alloc] init];
reminder.messageId = @"msg123";
reminder.channelId = @"channel123";
reminder.channelType = WKChannelTypePerson;
reminder.type = WKReminderTypeMention;
reminder.text = @"æ‚¨è¢«æåŠäº†";

[[WKIM shared].reminderManager saveReminders:@[reminder]];
```

### ç›‘å¬æé†’

```objc
// ç›‘å¬æé†’æ›´æ–°
[[WKIM shared].reminderManager addRefreshListener:^(NSArray<WKReminder *> *reminders) {
    // å¤„ç†æ–°æé†’
    for (WKReminder *reminder in reminders) {
        NSLog(@"æ–°æé†’: %@", reminder.text);
    }
}];
```

## æ–‡ä»¶ä¸Šä¼ é›†æˆ

### è‡ªå®šä¹‰æ–‡ä»¶ä¸Šä¼ 

```objc
// å®ç°è‡ªå®šä¹‰æ–‡ä»¶ä¸Šä¼ 
[[WKIM shared].messageManager setOnUploadAttachmentListener:^(WKMessage *message, void (^result)(WKMessageAttachment *attachment)) {
    // æ‚¨çš„è‡ªå®šä¹‰ä¸Šä¼ é€»è¾‘
    [self uploadFile:message.content completion:^(NSString *url) {
        WKMessageAttachment *attachment = [[WKMessageAttachment alloc] init];
        attachment.url = url;
        result(attachment);
    }];
}];
```

### ä¸‹è½½è¿›åº¦

```objc
// ç›‘æ§ä¸‹è½½è¿›åº¦
[[WKIM shared].messageManager setOnDownloadAttachmentListener:^(WKMessage *message, void (^result)(WKMessageAttachment *attachment)) {
    // å¸¦è¿›åº¦çš„è‡ªå®šä¹‰ä¸‹è½½é€»è¾‘
    [self downloadFile:message.content.url progress:^(float progress) {
        // æ›´æ–°è¿›åº¦ UI
    } completion:^(NSString *localPath) {
        WKMessageAttachment *attachment = [[WKMessageAttachment alloc] init];
        attachment.localPath = localPath;
        result(attachment);
    }];
}];
```

## é«˜çº§é…ç½®

### è‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†å™¨

```objc
// æ³¨å†Œè‡ªå®šä¹‰æ¶ˆæ¯å¤„ç†å™¨
[[WKIM shared].messageManager addMessageProcessor:^WKMessage *(WKMessage *message) {
    // åœ¨ä¿å­˜/æ˜¾ç¤ºä¹‹å‰å¤„ç†æ¶ˆæ¯
    if (message.content.contentType == 3) { // GIF æ¶ˆæ¯
        // GIF æ¶ˆæ¯çš„è‡ªå®šä¹‰å¤„ç†
    }
    return message;
}];
```

### æ¶ˆæ¯åŠ å¯†

```objc
// å®ç°æ¶ˆæ¯åŠ å¯†
[[WKIM shared].messageManager setOnEncryptMessageListener:^NSData *(NSData *data) {
    // åŠ å¯†æ¶ˆæ¯æ•°æ®
    return [self encryptData:data];
}];

[[WKIM shared].messageManager setOnDecryptMessageListener:^NSData *(NSData *encryptedData) {
    // è§£å¯†æ¶ˆæ¯æ•°æ®
    return [self decryptData:encryptedData];
}];
```

## æ€§èƒ½ä¼˜åŒ–

### æ¶ˆæ¯ç¼“å­˜

```objc
// é…ç½®æ¶ˆæ¯ç¼“å­˜è®¾ç½®
WKOptions *options = [WKIM shared].options;
options.messageMaxCacheCount = 1000; // æ¯ä¸ªé¢‘é“æœ€å¤§ç¼“å­˜æ¶ˆæ¯æ•°
options.messageCacheExpireTime = 7 * 24 * 60 * 60; // 7å¤©ï¼ˆç§’ï¼‰
```

### æ•°æ®åº“ä¼˜åŒ–

```objc
// ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½
[[WKIM shared].messageManager optimizeDatabase];

// æ¸…ç†æ—§æ¶ˆæ¯
[[WKIM shared].messageManager clearMessagesOlderThan:30]; // 30å¤©
```

## é”™è¯¯å¤„ç†

### é«˜çº§é”™è¯¯å¤„ç†

```objc
// è®¾ç½®å…¨é¢çš„é”™è¯¯å¤„ç†
[[WKIM shared] setOnConnectionStatusListener:^(WKConnectionStatus status, WKConnectionReason reason) {
    switch (status) {
        case WKConnectionStatusConnected:
            NSLog(@"è¿æ¥æˆåŠŸ");
            break;
        case WKConnectionStatusDisconnected:
            NSLog(@"è¿æ¥æ–­å¼€: %@", @(reason));
            // å¤„ç†é‡è¿é€»è¾‘
            break;
        case WKConnectionStatusConnecting:
            NSLog(@"è¿æ¥ä¸­...");
            break;
    }
}];
```

## ä¸‹ä¸€æ­¥

<CardGroup cols={2}>
  <Card
    title="åª’ä½“æ¶ˆæ¯"
    icon="image"
    href="/zh/sdk/wukongim/ios/media"
  >
    äº†è§£å›¾ç‰‡ã€è§†é¢‘å’ŒéŸ³é¢‘æ¶ˆæ¯
  </Card>
  <Card
    title="é¢‘é“ç®¡ç†"
    icon="hash"
    href="/zh/sdk/wukongim/ios/channel"
  >
    ç®¡ç†é¢‘é“å’Œæˆå‘˜
  </Card>
  <Card
    title="ä¼šè¯ç®¡ç†"
    icon="comments"
    href="/zh/sdk/wukongim/ios/conversation"
  >
    å¤„ç†ä¼šè¯åˆ—è¡¨å’Œæ›´æ–°
  </Card>
  <Card
    title="è¿æ¥ç®¡ç†"
    icon="wifi"
    href="/zh/sdk/wukongim/ios/connection"
  >
    é«˜çº§è¿æ¥å’Œç½‘ç»œå¤„ç†
  </Card>
</CardGroup>
